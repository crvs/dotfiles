autocmd!
" Vundle {{{
set nocompatible
filetype off
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

" management
Plugin 'prettier/vim-prettier'
Plugin 'gmarik/Vundle.vim'
" distance arrayPlugin 'vim-scripts/DoxygenToolkit.vim'
Plugin 'easymotion/vim-easymotion'
Plugin 'xolox/vim-notes'
Plugin 'xolox/vim-misc'
"Plugin 'roxma/nvim-completion-manager'
Plugin 'kana/vim-niceblock'

Plugin 'mileszs/ack.vim'
Plugin 'Raimondi/delimitMate'

Plugin 'abaldwin88/roamer.vim'
Plugin 'w0rp/ale'

" ide style
Plugin 'mbbill/undotree'
Plugin 'scrooloose/nerdcommenter.git'

" tags
Plugin 'majutsushi/tagbar'
Plugin 'ludovicchabant/vim-gutentags'

" git
Plugin 'tpope/vim-fugitive'

" text objects (think around/inside-obj)
Plugin 'kana/vim-textobj-user'

" latex
Plugin 'lervag/vimtex'

Plugin 'junegunn/goyo.vim'

Plugin 'tpope/vim-surround'
Plugin 'tpope/vim-unimpaired'
Plugin 'tpope/vim-repeat'
Plugin 'tpope/vim-dispatch'

Plugin 'Shougo/unite.vim'

Plugin 'christoomey/vim-tmux-navigator'

" colors
Plugin 'chriskempson/base16-vim'

Plugin 'gioele/vim-autoswap.git'

Plugin 'haya14busa/incsearch.vim'

Plugin 'kshenoy/vim-signature'

Plugin 'rhysd/vim-clang-format'

Plugin 'tmhedberg/matchit'

" Plugin 'vim-scripts/gnupg.vim.git'
Plugin 'vim-scripts/OmniCppComplete.git'

call vundle#end()
filetype plugin indent on

" }}}
" {{{

" use ag (silver searcher)
let g:ackprg = "ag --vimgrep"

" don't automatically jump
cnoreabbrev Ack Ack!
nnoremap <Leader>a :Ack!<Space>

" }}}
" {{{ OmniCpp + gutentags

let OmniCpp_MayCompleteDot = 1
let OmniCpp_MayCompleteArrow = 1
let OmniCpp_MayCompleteScope = 1

let OmniCpp_DefaultNamespace = ["std","_GLIBCXX_STD"]

au BufEnter *.c,*.cpp,*.hpp,*.h call TagOptions()

function! TagOptions()
    if !filereadable('.gutctags')
        !echo "-R\n--c++-kinds=+p\n--fields=+iaS\n--extra=+q" > .gutctags
    endif
endfunction
"for omnicompletion cpp files should be run into ctags with
" ctags -R --c++-kinds=+p --fields=+iaS --extra=+q .
" }}}

" {{{ fix colors

set termguicolors
if filereadable(expand("~/.vimrc_background"))
    "let base16colorspace=256
    source ~/.vimrc_background
endif

"let &t_8f = "[28;2;%lu;%lu;%lum"
"let &t_8b = "[48;2;%lu;%lu;%lum"

" }}}
" Goyo {{{

:nnoremap <silent> <f5> :Goyo<cr>
:inoremap <silent> <f5> <esc>:Goyo<cr>a

" }}}
" todo.txt {{{

:nnoremap <leader>tt :OpenTodo<cr>
:nnoremap <leader>td :execute ':e ' . g:todo_txt_done<cr>

:let g:todo_txt_todo='~/.todo.txt/todo.txt'
:let g:todo_txt_done='~/.todo.txt/done.txt'
:command! OpenTodo :execute ':e '. g:todo_txt_todo

:augroup my_todo_txt
:   autocmd!
:   autocmd BufEnter,BufRead todo.txt :nmap <leader>at $F@i <esc>BE dwi +
:   autocmd BufEnter,BufRead todo.txt :nmap <leader>ac $a @
:   autocmd BufEnter,BufRead todo.txt :nmap <leader>ad $a due:
:augroup END

" }}}
" pasting {{{
" paste from clipboard to next/prev line
" needs vim unimpaired
:nmap <leader>p "*]p
:nmap <leader>P "*[p
" }}}
"misc defaults {{{

:cmap '' '<,'>

:nnoremap <silent> <Leader>vs :<C-u>let @z=&so<CR>:set so=0 noscb<CR>:bo vs<CR>Ljzt:setl scb<CR><C-w>p:setl scb<CR>:let &so=@z<CR>

:let mapleader=','
:set foldmethod=marker

" temp folder and files
:set dir=/tmp

" reopen the current file
:nnoremap <silent> <leader>e :e<cr>
:nnoremap <silent> <leader>ee :e!<cr>
" fast edit vimrc
:nnoremap <silent> <leader>ev :vsplit $MYVIMRC<cr>
:nnoremap <silent> <leader>sv :source $MYVIMRC<cr>

" nice guides

:autocmd VimResized * :normal <c-w>=
" }}}
" keep 10 lines visible under the cursor {{{

" }}}
"parenthesis and matchings {{{
:nnoremap <leader>" ciW"<esc>pa"<esc>
:nnoremap <leader>' ciW'<esc>pa'<esc>
:nnoremap <leader>( ciW(<esc>pa)<esc>
:nnoremap <leader>[ ciW[<esc>pa]<esc>
:nnoremap <leader>{ ciW{<esc>pa}<esc>
:nnoremap <leader>< ciW<<esc>pa><esc>:

:vnoremap <leader>" c"<esc>pa"<esc>
:vnoremap <leader>' c'<esc>pa'<esc>
:vnoremap <leader>( c(<esc>pa)<esc>
:vnoremap <leader>[ c[<esc>pa]<esc>
:vnoremap <leader>{ c{<esc>pa}<esc>
:vnoremap <leader>< c<<esc>pa><esc>

" }}}
:nnoremap <silent> <f3> :UndotreeToggle<cr>

:nnoremap <silent> <f4> :Tagbar<cr>
:nnoremap <silent> <f4>p :TagbarTogglePause<cr>
" tags {{{
"let g:easytags_file = "./tags"
"let g:easytags_async = 1
" }}}
" tab name {{{
set title
function! s:set_title()
let &titlestring = 'vim:'.expand('%')
call system('tmux rename-window ' . &titlestring)
endfunction

au BufReadPost,BufEnter * call <SID>set_title()
" }}}
" NERDCommenter {{{
let NERDRemoveExtraSpaces=1
let NERDTrimTrailingWhitespaces=1
let NERDSpaceDelims=1
let NERDRemoveAltComs=1
" }}}
" netrw (file manager) {{{
nnoremap <f2> :Lexplore<cr>
let g:netrw_list_hide = '\(^\.\|\~$\)'
" }}}
" overrides {{{


:function! s:Free_c_keys()
:   if mapcheck('<C-Right>', 'n') != ':TmuxNavigateRight<cr>'
:       nnoremap <silent> <C-Right> :TmuxNavigateRight<cr>
:   endif
:   if mapcheck('<C-Up>', 'n') != ':TmuxNavigateUp<cr>'
:       nnoremap <silent> <C-Up> :TmuxNavigateUp<cr>
:   endif
:   if mapcheck('<C-Down>', 'n') != ':TmuxNavigateDown<cr>'
:       nnoremap <silent> <C-Down> :TmuxNavigateDown<cr>
:   endif
:   if mapcheck('<C-Left>', 'n') != ':TmuxNavigateLeft<cr>'
:       nnoremap <silent> <C-Left> :TmuxNavigateLeft<cr>
:   endif
:   if mapcheck('<c-K>', 'n') != ':TmuxNavigateUp<cr>'
:      nnoremap <silent> <c-K> :TmuxNavigateUp<cr>
:   endif
:   if mapcheck('<c-J>', 'n') != ':TmuxNavigateDown<cr>'
:      nnoremap <silent> <c-J> :TmuxNavigateDown<cr>
:   endif
:   if mapcheck('<c-L>', 'n') != ':TmuxNavigateRight<cr>'
:      nnoremap <silent> <c-L> :TmuxNavigateRight<cr>
:   endif
:   if mapcheck('<c-H>', 'n') != ':TmuxNavigateLeft<cr>'
:      nnoremap <silent> <c-H> :TmuxNavigateLeft<cr>
:   endif
:   if mapcheck('<c-/>', 'n') != ':TmuxNavigatePrevious<cr>'
:      nnoremap <silent> <c-/> :TmuxNavigatePrevious<cr>
:   endif
:endfunction

:let g:tmux_navigator_no_mappings = 1
" change the tmux window name


" }}}
" make {{{

" for scripts
:autocmd BufRead *.sh,*.py :nmap <silent> <leader>ll :! ./%<cr>

" for makefiles
:autocmd BufRead *.c,*.cpp,*.h,*.hpp nmap <silent> <leader>ll :make<cr>

" }}}
" gvim {{{
:if  has("gui_running")
:    set guioptions=''
:endif

" }}}
"   Clangformat {{{
:let g:clang_format#style_options = {
            \ 'AllowShortIfStatementsOnASingleLine' : 'true',
            \ 'ColumnLimit' : '80',
            \ 'TabWidth' : '4',
            \ 'Standard' : 'C++11',
            \ 'SpacesInAngles' : 'true',
            \ }

:let g:clang_format#filetype_style_options = {
            \   'cpp' : {'Standard' : 'C++11'}
            \ }

:let g:clang_format#command='clang-format'

:nnoremap <silent> <leader>S :Startify<cr>
:autocmd BufRead *.c,*.cpp,*.h,*.hpp :nnoremap <leader>f :ClangFormat<cr>

"   }}}
"   Undotree {{{
:nnoremap <silent> <f3> :UndotreeToggle<cr>
:inoremap <silent> <f3>  <esc>:UndotreeToggle<cr>

" }}}
" LaTeX {{{
set conceallevel=0
if !exists('g:ycm_semantic_triggers')
    let g:ycm_semantic_triggers = {}
  endif
  let g:ycm_semantic_triggers.tex = [
        \ 're!\\[A-Za-z]*cite[A-Za-z]*(\[[^]]*\]){0,2}{[^}]*',
        \ 're!\\[A-Za-z]*ref({[^}]*|range{([^,{}]*(}{)?))',
        \ 're!\\hyperref\[[^]]*',
        \ 're!\\includegraphics\*?(\[[^]]*\]){0,2}{[^}]*',
        \ 're!\\(include(only)?|input){[^}]*',
        \ 're!\\\a*(gls|Gls|GLS)(pl)?\a*(\s*\[[^]]*\]){0,2}\s*\{[^}]*',
        \ 're!\\includepdf(\s*\[[^]]*\])?\s*\{[^}]*',
        \ 're!\\includestandalone(\s*\[[^]]*\])?\s*\{[^}]*',
        \ ]

    :let g:vimtex_complete_recursive_bib=1
    :let g:vimtex_labels_enable=1
    :let g:vimtex_view_general_viewer='evince'
    ":let g:vimtex_view_general_viewer='xpdf'
    :let g:tex_flavor="latex"
    :let g:Tex_DefaultTargetFormat='pdf'
    ":let g:vimtex_latexmk_options=' -synctex=0 '
    :let g:Tex_MultipleCompileFormats='pdf,dvi'
    ":let g:Tex_ViewRule_pdf='setsid xpdf 2>& /dev/null'
    ":let g:Tex_ViewRule_pdf='setsid evince 2>& /dev/null'
    ":let g:Tex_ViewRule_pdf='setsid zathura 2>& /dev/null'



"    :function s:last_changed_header()
"    :   let l:del_reg = @"
"    :   g/^% Last Change:/normal f:  D
"    :   normal "=strftime("%a %b %d %I:%M %p %Y %Z")p''
"    :   let @" = l:del_reg
"    :endfunction


    :augroup my_tex_group
    :   autocmd!
    :   autocmd BufRead *.tex :let g:Tex_CompileRule_pdf="pdflatex -interaction=nonstopmode -file-line-error-style $* 1>& /dev/null"
    :   autocmd BufRead *.tex :let Tex_FoldedEnvironments="verbatim,comment,eq,gather,align,figure,table,thebibliography,keywords,abstract,titlepage,eq,theorem,corollary,lemma,algorithm,proof,IEEEproof,remark,definition,tikzpicture"
    " :   autocmd BufWritePre *.tex :silent:call s:last_changed_header()
    :augroup END

    "" fast compile
    ":autocmd BufRead *.tex :nnoremap <silent> ZM :w<CR>:call Tex_RunLaTeX()<CR>
    " easy comment
    ":autocmd BufEnter *.tex :nnoremap <silent> <leader>c I%<esc>
    ":autocmd BufEnter *.tex :vnoremap <silent> <leader>c norm I%<esc>
    ":autocmd BufLeave *.tex :nunmap <leader>c
    ":autocmd BufLeave *.tex :vunmap <leader>c
    " open pdf
    " :autocmd BufRead *.tex :command! OpenPDF :execute '!setsid zathura 'expand('%:h').'/'.expand('%:r').'.pdf 2>&/dev/null &'
    " more environments to collapse




    ":autocmd ColorScheme * :highlight Folded cterm=bold ctermbg=none ctermfg=green

    :nnoremap <localleader>lt :<c-u>Unite vimtex_toc<cr>
    :nnoremap <localleader>ly :<c-u>Unite vimtex_labels<cr>

" }}}
    " Search {{{
    :set hlsearch
    :set incsearch
    :nnoremap n nzz
    :nnoremap N Nzz
    :autocmd ColorScheme * :highlight Search ctermfg=none ctermbg=none cterm=reverse
    ":autocmd ColorScheme * :highlight Match  ctermfg=black ctermbg=yellow cterm=NONE

    :nnoremap <silent> <leader>h yiw:nohl<cr>:match Search /"/<cr>
    :nnoremap <silent> <leader>H yiw:call matchadd( "Search" , """)<cr>
    :vnoremap <silent> <leader>h y:nohl<cr>:match Search /\M"/<cr>
    :vnoremap <silent> <leader>H y:call matchadd( "Search" , "\M"")<cr>
    :nnoremap <silent> <leader>* yiw:vimgrep /"/ *<cr>
    ":nnoremap <silent> <leader>ct :cd %:h<cr>:! ctags -R .<cr>

    " toggle quickfix window
    :let s:quickfix = 0
    :nnoremap <silent> <leader>q :call <sid>toggle_things("quickfix window","s:quickfix",":copen",":cclose")<cr>

    " toggle location window
    :let s:location = 0
    :nnoremap <silent> <leader>L :call <sid>toggle_things("location window","s:location",":lopen",":lclose")<cr>

    :nnoremap <silent> j gj
    :nnoremap <silent> k gk
    " }}}
" removing arrows {{{
" normal mode
nnoremap <Left>  <nop>
nnoremap <Right> <nop>
nnoremap <Up>    <nop>
nnoremap <Down>  <nop>

" insert mode
inoremap <Left>  <nop>
inoremap <Right> <nop>
inoremap <Up>    <nop>
inoremap <Down>  <nop>

" visual mode
vnoremap <Left>  <nop>
vnoremap <Right> <nop>
vnoremap <Up>    <nop>
vnoremap <Down>  <nop>
" }}}
    " vim calendar options for google calendar {{{
    " :let g:calendar_time_zone=+0060

    :let g:calendar_week_number=1
    :let g:calendar_google_calendar=1
    :let g:calendar_google_task=1

    " }}}
" statusbar {{{
":set rnu "show numbering relative to the current line

function! PasteStatus()
    if &paste
        return "[Paste]"
    else
        return ""
    endif
endfunction

:set number
set laststatus=2
set statusline=%-2n "buffer number
set statusline+=%<
set statusline+=\ %f "file path
set statusline+=\ %r " readonly
set statusline+=\ %{PasteStatus()}
set statusline+=\ %h " help
set statusline+=\ %m " modified
set statusline+=\ %q " quickfix/location list
set statusline+=%= " switch to right side
set statusline+=%{gutentags#statusline()} " tags status
set statusline+=%5l " line number (with 5 places reserved from the left)
set statusline+=- "separator
set statusline+=%-4c%V " column number padded with 3 decimal places
set statusline+=\ %P " percentage

" }}}
    " common typos {{{
    :iabbr teh the
    :iabbr taht that

    ":autocmd ColorScheme * :highlight SpellBad ctermfg=black ctermbg=green guifg=black guibg=yellow cterm=NONE
    " better switching between buffers


    :nmap <silent> <leader>b :bn<cr>
    :nmap <silent> <leader>B :bp<cr>
    :nmap <silent> <leader>d :bd<cr>
    :nmap <silent> <leader>D :bd!<cr>

    " allow to use hidden buffers more liberally
    :set hidden
    :set grepprg=grep\ -nH\ $*

    " allow backspacing over everything in insert mode
    ":set backspace=indent,eol,start

    :set backup        " keep a backup file (restore to previous version)
    :set undofile      " keep an undo file (undo changes after closing)
    :set backupdir=~/.vimtmp,.
    :set undodir=~/.vimtmp,.
    :set directory=~/.vimtmp,.
    :set history=50      " keep 50 lines of command line history
    :set ruler       " show the cursor position all the time
    :set showcmd     " display incomplete commands


    " CTRL-U in insert mode deletes a lot.  Use CTRL-G u to first break
    " undo, so that you can undo CTRL-U after inserting a line break.
    :inoremap <C-U> <C-G>u<C-U>

    " In many terminal emulators the mouse works just fine, thus enable
    " it.
    "":set mouse=a


    " Switch syntax highlighting on, when the terminal has colors Also
    " switch on highlighting the last used search pattern.
    :syntax on



    " Convenient command to see the difference between the current buffer
    " and the file it was loaded from, thus the changes you made.  Only
    " define it when not defined already.
    :if !exists(":DiffOrig")
    command! DiffOrig vert new | set bt=nofile | r ++edit # | 0d_ | diffthis
                \ | wincmd p | diffthis
    :endif

    :set complete=.,w,b,u,t,i,kspell
    " }}}
"linting options (ALE)
let g:ale_lint_on_text_changed=0
let g:ale_lint_on_insert_leave=1
"fast reload quickfix
nnoremap <leader>qr :cfile<cr>
" set path+=** " not such a great idea after all

augroup Markdown_
    autocmd!
    let g:markdown_autocomp = 0
    function! Toggle_compile()
        if g:markdown_autocomp
            autocmd! Markdown_autocomp
            let g:markdown_autocomp = 0
            echom "stoping markdown autocompilation"
        else
            augroup Markdown_autocomp
                autocmd BufWritePost *.md silent execute "Dispatch !pandoc '%' -o '%:r'.pdf 1>& /dev/null &"
                let g:markdown_autocomp = 1
            augroup END
            echom "started markdown autocompilation"
        endif
    endfunction

    autocmd FileType markdown :nnoremap <silent> <leader>lv :Dispatch !setsid evince %:r.pdf &<cr>
    autocmd FileType markdown :nnoremap <leader>ll :call Toggle_compile()<cr>
    autocmd FileType markdown :syntax clear MarkdownError
augroup END

set background=dark

" Force save
:cmap w!! w !sudo tee % > /dev/null<cr>

:set tabstop=4 shiftwidth=4 expandtab
:set smartindent
:set showbreak=>\ "begin broken line
:set linebreak
:call <sid>Free_c_keys()

:hi SpellBad term=bold,underline cterm=bold,underline

:set listchars=eol:¬,tab:>\ ,trail:*,extends:>,precedes:<,nbsp:_
:set list
:set scrolloff=5

:let g:notes_directories = ['~/.vim-notes']
:set makeprg='cbuild'
